@inherits LayoutComponentBase
@using AuditoriaBbraun.BlazorWeb.Services.Authentication
@using Microsoft.AspNetCore.Components.Authorization
@inject IAuthClientService AuthService
@inject NavigationManager Navigation

<div class="page">
    <aside class="sidebar">
        <NavMenu />
    </aside>

    <main>
        <header class="top-bar px-4">
            <div class="brand">
                <img src="/img/b-braun-logo.png" alt="B. Braun" class="brand-logo" />
                <span class="brand-divider" aria-hidden="true"></span>
                <div>
                    <p class="brand-title">DWS System</p>
                </div>
            </div>
            <div class="top-actions">
                <AuthorizeView>
                    <Authorized>
                        <!-- Se muestra solo si hay un usuario Logueado -->
                        <span class="me-3 fw-bold">@context.User.Identity?.Name</span>
                        <button class="btn btn-outline-danger btn-sm" @onclick="CerrarSesion">
                            Salir
                        </button>
                    </Authorized>
                    <NotAuthorized>
                        <!-- Si no hay un usuario Logueado -->
                        <a href="login" class="btn btn-primary btn-sm">Acceder</a>
                    </NotAuthorized>
                </AuthorizeView>
            </div>
        </header>

        <article class="content px-4">
            @Body
        </article>
    </main>
</div>

<div id="blazor-error-ui">
    Ocurrió un error inesperado.
    <a href="" class="reload">Recargar</a>
    <a class="dismiss" aria-label="Cerrar">🗙</a>
</div>

@code {
    private async Task CerrarSesion()
    {
        await AuthService.Logout();
        // Forzamos recarga para limpiar estado y volver al login
        Navigation.NavigateTo("login", forceLoad: true);
    }
}